---
title: "Middle Earth State Scale Survey Report Demo"
date: "June 5, 2019"
output:
  word_document:
    reference_docx: ReferenceStyle2.docx
  html_document:
    df_print: paged
fig_caption: yes
always_allow_html: yes
---
```{r setup, echo=FALSE, message=FALSE, warning=FALSE}

# R version 3.4.4 "Someone to Lean On"

knitr::opts_chunk$set(echo = FALSE)
suppressPackageStartupMessages(library(tidyverse)) #1.2.1
suppressPackageStartupMessages(library(sf))#0.6-1
extrafont::loadfonts(device="win") # run this once each session, see https://cran.r-project.org/web/packages/extrafont/README.html for more info on the font_import() function required for "	font family not found in Windows font database" warning to go away
suppressPackageStartupMessages(library(sp))
suppressPackageStartupMessages(library(rgdal))
suppressPackageStartupMessages(library(extrafont)) #the first time, you need to import fonts with: font_import()

# Data needed for maps needs to be in this report vs in global file for figure generation 

#Download spatial data
#README: download files from github: https://github.com/jvangeld/ME-GIS
#click on green "Clone or download" button, and download zip file

#Import spatial data
setwd("C:/Users/LETTEMA/Documents/SSS_reportTool/")  ####****CHANGE THIS DIRECTORY TO YOUR FILE LOCATIONS****
state<-rgdal::readOGR('ME-GIS-Master', 'Coastline2', verbose=FALSE) #import state and/or other shapfile.  'ME-GIS-Master is a folder  in 'SSS_reportTool' folder.  Coastline2 is the shapefile in the 'ME-GIS-Master' folder.
features<-rgdal::readOGR('ME-GIS-Master', 'Rivers19', verbose=FALSE) #import other feature shapefiles (like ecoregions, basins, or other categories) you want to map
towns<-rgdal::readOGR('ME-GIS-Master', 'Towns', verbose=FALSE) #used to generate fake sample points

#MakeData.R generates fake data (sample data, cumulative distribution function (CDF) values, and Categorical Condition Estimates (Catdata)) for this example.  You can delete this line; you will upload CDF data in SSglobal.R, and upload SampleData or CatData into the variables below (if needed)
source('MakeData.R') 

#CatData<-read.csv('CatData.csv'. stringsAsFactors = FALSE)

source('SSglobal.R') #this does data preparation for the report, you will need to keep this.  The CDF data is uploaded in here.

SampleData<-SampleData  #This is where Upload your own sample data. For this example it is made in MakeData.R
#SampleData<-read.csv('SampleDatabase.csv'. stringsAsFactors = FALSE)

```

## Summary and Data Needed
 The goal of this report/tool was to provide examples of Rmarkdown text integrated with Rcode that could be modified to produce other reports.  The Rcode references datasets (discussed below) that dynamically populates text and updates graphs for every iteration of the report, as long as the data is updated.  The Rcode also provides different visualization (graph) options.   

This markdown document is largely based off of Emma Jones and Jason Hill's work in Virginia.  They used the code to create their Freshwater Probablistic Monitoring (ProbMon) Results chapter of their [2018 Integrated Report](https://www.deq.virginia.gov/programs/Water/WaterQualityInformationTMDLs/WaterQualityAssessments/2018305(b)303(d)IntegratedReport.aspx).  Once their PropMon results database (new Cdf curves and/or condition estimates) is updated, next cycle all they have to do is modify a few lines of code and re-render (knit to word) their .Rmd to produce their 2020 IR ProbMon chapter for managers to review. For any questions or errors in this code, please contact Leah Ettema (ettema.leah@epa.gov, 304-234-0245). 

###Software and code
This StateScaleSurveyTool.Rmd report was created using:

R version 3.5.1 (2018-07-02)

RStudio Version 1.1.423

Platform: x86_64-w64-mingw32/x64 (64-bit)

Running under: Windows >= 8 x64 (build 9200)

The SSglobal.R script performs data manipulation and creates some lookup functions.  This could be done in the .Rmd environment, however it's good practice to store functions in a separate .R file. It also helps make the .Rmd code less unwieldly. See [this link](https://www.earthdatascience.org/courses/earth-analytics/multispectral-remote-sensing-data/source-function-in-R/) for more information on sourcing code.

*All data used in this report is not real*

I copied and modified some of VA's data in MakeData.R; you will not need the MakeData.R script once you use your own data.  The code comments in the .Rmd and SSglobal.R highlight where to insert your data. The names of subpopulations have been changed to be in `r State`.  I selected only a few parameters and geographic subdivisions/subpopulations, but the code would be similar if you wanted to report on others.

######

###Data needed for your state scale survey report

*Condition Estimate Results*

You will need at least one of the following data inputs.  These are typically created from analysis of probablistic survey data with the R package [spsurvey](https://cran.r-project.org/web/packages/spsurvey/spsurvey.pdf).  

* I - CDF results. 

Column names:
`r colnames(CDFdat)`

AND/OR

* II - Categorical Condition Estimate results. 

Column names:
`r colnames(CDFdat)`

Data Wrangling: 

If you want to report on or compare conditions over multiple years, you may need make one subpopulation in your population condition results database correspond to the time of reporting or add a column for every IR year and fill it with yes/no or year to allow for easy filtering over time.

*Other Optional Data*

* Geospatial data (shapefiles or excel sheets with lat/long) for any maps you wish to display (the StateScaleSurveySupplement.Rmd has a couple spatial data manipulation and plotting examples)
* Sample database (or some other table) if you wish to report sample sizes other than the ones used to create condition estimates (Nresp).  This could include number of samples collected over the entire history of your probabilisitc monitoring program (statewide or by other geographical subdivision) or total number of sites evaluated but not sampled (eg. stream was unsafe or property access was denied).   

If you want to report samples sizes other than condition estimate Nresp, ideally you would reference a probabilistic monitoring database throughout the state scale survey report that will also be used in future reports. This allows for more automation; once the sampling database is updated, all of the other numbers and graphs will also be updated when the code is rendered again. It also provides more transparency, reproducability, and quality control; the user can trace the source of all numbers and graphs. However, if your database is not conducive to that, you could create a new or separate table/spreadsheet with the sample information every time you create a new report.

######

*Decide the Story to Tell*

This code provides some examples of what could be displayed in an an IR probabalistic monitoring chapter report.  You will likely need to do some exploratory analysis first, to decide what to present.  Then, you can take the relevant chunks of code presented here and modify as needed.

*RMarkdown Text Notes*

In RMarkdown text, spaces and lines between characers matter for text formatting (bullets, titles, new paragraphs, etc.). For useful text styling tips, I recommend the RMarkdown [Cheat Sheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf) and [this link](https://rmarkdown.rstudio.com/authoring_basics.html).  To set page breaks in this document, I used a word style reference document, setting Header 6 (referenced with 6 pound signs "######") to be a page break rather than a header. See [Insert Page Breaks in RMarkdown Word Document](https://datascienceplus.com/r-markdown-how-to-insert-page-breaks-in-a-ms-word-document/). Images, like a logo header or a final map .jpeg, could be added using syntax noted in the Cheat Sheet. 

RMarkdown has the capabilities to produce pdf, word, or html reports.  Pdf reports offer easier and nicer formatting options, especially for tables.  However, word reports provide easier commenting for reviewers after rendering, which is why this example is a word document.  You would likely need to modify the Markdown text code in this example (using Pandoc/Latex) to generate a good-looking pdf.  "Pandoc is a slightly extended and revised version of standard Markdown language.  Markdown was originally designed with HTML generation in mind, pandoc is designed for multiple output formats. Thus, while pandoc allows the embedding of raw HTML, it discourages it, and provides other, non-HTMLish ways of representing important document elements like definition lists, tables, mathematics, and footnotes."[^1]

[^1]: [Pandoc's Markdown](https://pandoc.org/MANUAL.html#pandocs-markdown)

*Helpful R links:*

* [Markdown Basics](https://rmarkdown.rstudio.com/authoring_basics.html) 
* ["How To" Video on Word Document Styling (Using a Style Reference Documents)](https://www.coursera.org/lecture/reproducible-templates-analysis/customizing-a-word-document-idnEf)
* [Happy collaboration with Rmd to docx](https://rmarkdown.rstudio.com/articles_docx.html): step by step guide on how to create a style reference document
* [Word documents in R Markdown](https://bookdown.org/yihui/rmarkdown/word-document.html)
* [Spatial Data training by USEPA ORD](https://mhweber.github.io/R-User-Group-Spatial-Workshop-2018/index.html#)
* [Cookbook for R, Graph Colors](http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/), includes a colorblind-friendly color palette for graphing
* [GGplot2 Titles, Subtitles and Captions](https://www.datanovia.com/en/blog/ggplot-title-subtitle-and-caption/)
* [Plotting Geospatial Data with ggplo2](http://mazamascience.com/WorkingWithData/?p=1494)

See the StateScaleSurveySupplement.Rmd for more geospatial plotting options, stressor extent plots, and relative risk plots.

######

###Report Outline
This example document is broken up into two sections:

* Tables and graphs generated from the Cumulative Distribution Function (CDF) tables (this is primarily how VA reports)
* Tables and graphs generated from Categorical Condition Estimates

######

## Part 1: Report Examples from CDF Results

## Chapter 2.4 FRESHWATER PROBABILISTIC MONITORING

### 2.4.1 Executive Summary

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProbMon is designed to answer questions about statewide and regional water quality conditions through the use of a statistically valid sample frame across large geographic areas. The `r State` `r Agency` Probabilistic Monitoring Program, or ProbMon, has sampled `r nrow(filter(SampleData, Sampled==1))` wadeable sites statewide since the program began in 2009 (Figure 2.4-3). Over `r signif(nrow(SampleData %>% filter(IR2016=='2016') %>% filter(Sampled==1)),digits=2)` sites were sampled during the `r IRyear` assessment period (Figure 2.4-2). Although the majority of water quality parameters meet applicable water quality criteria, the biological condition of `r State` streams fail to meet expectations in approximately `r format(filter(paramsummary, Parameter=='MMI\n(Biomonitoring)')$pct,digits=1)`% of stream miles (Figure 2.4-1). Biological condition is assessed using aquatic organisms as indicators of stream health. These biological impairments are believed to be caused in part by stressors that are not subject to water quality criteria such as streambed sedimentation, habitat disturbance, and nutrients. The most frequently occurring water quality problems are presented in Figure 2.4-1. ProbMon is a cost-effective way to evaluate `r State` streams and rivers, test new sampling methods, and support other `r Agency` water quality management activities like water quality standards development, Total Maximum Daily Load (TMDL) studies, and setting more defensible permit conditions.

##### Figure 2.4-1.  Percentage of stream miles with water quality parameters failing to pass criteria/screening values. Red bars indicate a parameter with no water quality standard and green bars indicate a parameter with water quality standard or screening value. These results represent data collected from `r IRrange`. 

```{r fig.height=2.5, fig.width=8, message=FALSE, warning=FALSE}
p2.4.1 <- suppressWarnings(ggplot(paramsummary,aes(Parameter,pct,fill=Standard,label=pct))+
                             geom_bar(stat='identity')+#supressWarnings is to prevent them from printing in word
  labs(x="Parameter", y = "Percent of Stream Miles Failing to Pass Criteria/Screening Values")+
  ylim(-1,70)+ #render and estimate distance (ymax) when text labels are plotted 
  scale_x_discrete(breaks=paramsummary$Parameter,labels=paramsummary$Parameter)+ #parameter  spacing and labels
  coord_flip()+ #make horizontal instead of vertical bars
  geom_text(aes(label=paste(format(pct,digits=1,nsmall=1),"% +/- ", 
                            format(MoE,digits=1,nsmall=1),"%",sep=""),
                y=60), size=3, family="Arial")+ #text labels 
  geom_errorbar(aes(ymin=pct-MoE, ymax=pct+MoE), width=0.2)+ # error bars, #still y even though coordinates are flipped
  scale_fill_manual(values=c("#D55E00","#009E73"))+ #colors of bars (fill=Standard, so need as many unique colors as unique values of Standard)
  theme_minimal()+ #backgroup theme
  theme(legend.position="none", # no legend, center title
        text=element_text(family="Arial"),
        panel.grid.major.x = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"), # no background grid
        plot.margin=unit(c(0,1,0,0),'cm'), #to fit in document appropriately
        aspect.ratio=4/6)) #to fit in document appropriately
p2.4.1 
```

### 2.4.2 Introduction	

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Probabilistic monitoring is designed to answer basic questions like: What are the primary water quality problems in `r State`? How widespread are these problems, and what pollutants cause the greatest environmental stress to `r State` water resources? The General Assembly, citizens, environmental stakeholders, and the United States Environmental Protection Agency (USEPA) have encouraged the Department of Environmental Quality (`r Agency`) to answer these questions and to establish baseline water quality conditions for `r State` streams and rivers. ProbMon is one component of `r paste(Agency, "'s", sep="")` Water Quality Monitoring Strategy. Typically water quality monitoring stations are located at bridges, boat ramps or other public access points.  These monitoring stations are known as targeted monitoring sites. Targeted monitoring has great utility for identifying impaired waters, supporting TMDL and Implementation Plan modeling efforts, monitoring water quality trends over time, tracking local pollution events, and monitoring regulatory compliance of pollution sources. However, it is not appropriate to extrapolate results from targeted stations to un-sampled watersheds over large geographic areas. Data to address water quality questions from large geographic areas are best obtained from statistically designed studies with randomly chosen sample locations.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In `r State`, ProbMon sites are randomly selected using USEPA's probability survey design program (Stevens 1997; USEPA 2006).  From the beginning of `r State`'s ProbMon program in 2009 to the present, `r Agency` has evaluated over `r signif(nrow(SampleData), digits=3)` stations and sampled `r nrow(SampleData %>%  filter(Sampled==1))` sites  (Figure 2.4-3). Most of the monitoring efforts are in Rivers and Streams, and this report will present rivers and streams results.  In some cases, rivers and streams stations were evaluated, but not sampled for a variety of reasons including: the stream was rerouted by Ents, Elves denied access, it was saltwater influenced, or conditions to sample were not safe due to Orks. `r Agency` samples 30 to 60 random stations per year throughout `r State` for a variety of chemical, biological, and habitat parameters.  From January 1st, 2011 until December 31st, `r IRyearWindowEnd` `r Agency` evaluated `r nrow(SampleData %>% filter (IR2016 == '2016'))` sites and sampled `r nrow(SampleData %>% filter (IR2016 == '2016') %>% filter(Sampled==1))` stations (Figure 2.4-2). 

##### Figure 2.4-2. `r State` probabilistic monitoring locations from `r IRrange` (n = `r nrow(SampleData %>% filter (IR2016 == '2016') %>% filter(Sampled==1))`).  Please pretend that the points that appear in the ocean are either on small islands or on the mainland.  Creating data from other worlds has limitations.

```{r fig.width=5.75, fig.height=2.75}  
#Example VA Code
# par(mar=c(0,0,0,0),oma=c(0,0,0,0))
# plot(VAbasins,border='wheat3',col='wheat1',ylim=c(37.4,38.5))
# plot(IRstations2018,col='grey21',pch=19,cex=0.5,add=T)
# legend('left',legend=c('Major Basins','Probabilistic Sites (Wadeable)')
#        ,title='Legend',bty='n',inset=0.05,pch=c(15,15,19),cex=0.8
#        ,col=c('wheat1','grey21'))

par(mar=c(0,0,0,0), oma=c(0,0,0,0)) #mar and oma are margins for plotting
#https://www.r-graph-gallery.com/74-margin-and-oma-cheatsheet/
suppressWarnings(plot(state, border='black'))
lines(features, col="#56B4E9")
suppressWarnings(points(SampleData %>% 
                          filter (IR2016 == '2016') %>% 
                          filter(Sampled==1), 
                             col="#0072B2",pch=19,cex=0.5, add=T))
legend('bottomleft',legend=c('Middle Earth','Probabilistic Sites'),
       title='Legend',bty='n',inset=0.05, pch=c(15, 19), cex=0.8,
       col=c('black',"#0072B2"))

```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Estimates of percent river miles not meeting water quality criteria or established screening values are reported with 95% confidence intervals. The sampling frame provided by USEPA for `r State` streams and rivers includes 49,100 miles.  It is important to note that the total amount of assessed river miles may vary to some extent by parameter.  This number varies based on whether a monitoring tool was appropriate for the sampling location.  For example, `r Agency` biological monitoring tools are not validated for streams without a defined channel, thus streams dominated by wetlands like in the Dead Marshes cannot be assessed (approximately 5,000 miles).  The actual number of target stream miles (perennial, flowing freshwater) is much less because several thousands of stream miles are not perennial (e.g. the stream was dry when `r Agency` visited) or were found to be saltwater influenced. There is an estimated 1,200 miles of non-wadeable streams (also referred to as boatable sites), which must be sampled using large river habitat and biological sampling methods. Large river data collection, using a non-wadeable (boatable) methodology, is underway and the condition will be included in future 303(d) / 305(b) Integrated Report chapters. The ProbMon chapter provides estimates for all perennial, non-tidal, wadeable stream and river miles which equates to approximately 41,500 miles. 

##### Figure 2.4-3. `r State` probabilistic monitoring wadeable locations from 2009 - Present (n = `r nrow(SampleData %>%  filter(Sampled==1))`).

```{r fig.width=5.75, fig.height=2.5}  

#These latitudes and longitudes form the box of the plot you're going to make (include space for legend) 
minlat<-0
maxlat<-2000000
minlong<-300000
maxlong<-800000


par(mar=c(0,0,0,0),oma=c(0,0,0,0))
suppressWarnings(plot(state, border='black', ylim=c(minlat,maxlat), xlim=c(minlong,maxlong)))
suppressWarnings(lines(features, col="#56B4E9"))
suppressWarnings(points(SampleData %>% filter(Year=='2009'|Year=='2010'),col='red',pch=19,cex=0.5,add=T))
suppressWarnings(points(SampleData %>% filter(Year=='2011'|Year=='2012'),col='blue',pch=19,cex=0.5,add=T))
suppressWarnings(points(SampleData %>% filter(Year=='2013'|Year=='2014'),col='green',pch=19,cex=0.5,add=T))
suppressWarnings(points(SampleData %>% filter(Year=='2015'|Year=='2016'),col='purple',pch=19,cex=0.5,add=T))
suppressWarnings(points(SampleData %>% filter(Year=='2017'|Year=='2018'),col='orange',pch=19,cex=0.5,add=T))
legend('bottomleft',legend=c('Middle Earth','2009-2010 wadeable sites',
                          '2011-2012 wadeable sites','2013-2014 wadeable sites',
                          '2015-2016 wadeable sites','2017-2018 wadeable sites'),
       title='Legend',bty='n',inset=0.05,pch=c(15,19,19,19,19,19),cex=0.8,
       col=c('black','red','blue','green','purple','orange'))
```


### 2.4.3 Parameters with Water Quality Standards or Screening Values

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dissolved oxygen, pH, temperature, metals (dissolved and sediment), organic chemicals, and bacteria have applicable water quality criteria or screening values.  Water quality standards are regulatory thresholds developed to protect water quality conditions in support of swimming, fishing, and aquatic life designated uses. Screening values are non-regulatory thresholds used to interpret select water quality parameters. Overall results are summarized in Figure 2.4-1 and individual parameter results are discussed below. 

#### pH

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;One primary parameter used to evaluate water quality is pH.  pH measures the concentration of hydrogen ions in water or the amount of acidity present.  Since the pH scale is logarithmic to base 10, a decline in pH by one unit indicates a tenfold decrease in hydrogen ions.  At pH 7, a solution is neutral whereas pH values below 7 indicate acidic conditions and values above 7 indicate basic conditions.
  	
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stream pH depends on local geology, ecology, and anthropogenic influences. If a stream has poor buffering capacity, as is the case for a stream flowing over granite or shale, it may be naturally acidic.  In the case where inorganic acids such as sulfuric or nitric acid are introduced via rain, the low buffering capacity can be rapidly exhausted and the pH declines.  The resulting low pH may be detrimental to aquatic biota unaccustomed to low pH.  pH values harmful to aquatic life are below 6 or above 9.  This range is reflected in `r State`'s Water Quality Standards, where most waters must fall within a pH range of between 6 and 9. Natural pH values of 5 or below occur in swamp waters and should not be considered harmful to the native fauna common to those ecosystems.  pH standards can be determined on a case-by-case basis if pH deviates due to natural conditions as in swamps and other wetlands (Commonwealth of Middle Earth 2017). 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProbMon results show that `r format(filter(paramsummary,Parameter=='pH\n(Below 6)')$pct,digits=1,nsmall=1)`% of wadeable `r State` streams and rivers are estimated to have pH below 6 (Table 2.4-2). All stations with deviations in pH occurred at sites located in the coastal ecoregion where swamp waters are common, which indicates the need to continue revising site specific water quality standards. `r Agency` collects additional parameters, including Acid Neutralizing Capacity (ANC) and sulfate data at ProbMon stations to estimate the percent of streams impacted by acid rain and acid mine drainage. High sulfate values in low pH streams are indicative of acid mine drainage whereas streams with low ANC values are susceptible to episodic acidification from acid rain runoff (USEPA 2000).  However, based on ProbMon data collected during the `r IRyear` assessment period, `r Agency` estimates that no pH values are below 6 in the mountain ecoregions. Estimates are reflective of an average of two data points, where data are available.

##### Table 2.4-2.  Percent of waters with pH values Above or Below `r State`'s Water Quality Standard (`r IRrange`, n=`r max(filter(CDFdat,Subpopulation=='MiddleEarth'&Indicator=='pH')$NResp)`) 
```{r pH results table}
#from SSglobal
knitr::kable(pHsummary,align='c') #more table formatting options knitting to pdfs
```


#### Temperature

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Temperature affects water quality by potentially imposing a heat burden on aquatic life and by limiting the level of dissolved oxygen in water. Temperature in streams varies on seasonal and daily cycles.  Sunlight is the primary source of temperature change.  Stream temperature is also influenced by the temperature of the stream bed, groundwater inputs, and air in contact with the water surface. Temperature is inversely related to bank vegetation cover as less cover results in more exposure to the sun and higher instream temperatures. Also, runoff from impervious surfaces in urban areas may increase water temperature.  Finally, effluent that is discharged to a waterbody tends to have higher temperature than the receiving stream and may elevate instream water temperature. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stream temperature has a significant effect on aquatic organisms.  It can directly influence the types of organisms found in an aquatic system as well as their growth, behavior, metabolism, reproduction and feeding habits. `r State`'s temperature standards reflect the upper limit for the support of different forms of aquatic life (Commonwealth of Middle Earth 2017).  Standards for temperature vary, notably in cold water fisheries, but as a general rule, all waters in `r State` are required to have a temperature at or below 31 or 32 degrees Celsius.  

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Overall, `r Agency` estimates that temperature violations will be rare in `r State`'s wadeable streams (Table 2.4-3) during the spring and fall. However, it is important to note that ProbMon temperature data is seldom collected during the most stressful hydrologic and weather conditions. Estimates are reflective of an average of two data points, where data are available. In order to properly estimate temperature problems, temperature data must be collected continuously. Continuous temperature data collection began in 2016 at twenty probabilistic trend sites.

##### Table 2.4-3. Temperature results (`r IRrange`, n=555) compared to `r State`'s Water Quality Standard.  

```{r manual temp results table}

#If you want to manually enter in results to create a table for the report, you can do it like this, and enter in the sampling number manually in the table title

temp <- data.frame(c1='Temperature',c2='1.0% ( +/- 0.3% )')
names(temp) <- c('Parameter','Above Standard (31/32 degrees Celsius)')
knitr::kable(temp,align='c')
```

### 2.4.4 Biological Monitoring

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Biological monitoring, or biomonitoring, of streams and rivers is an integral component of `r Agency`'s water quality monitoring program.  Biomonitoring allows `r Agency` to assess the overall ecological condition of streams and rivers by evaluating stream condition with respect to suitability for support of aquatic communities. In `r State`, benthic macroinvertebrate communities are used as indicators of ecological condition and to address the question of whether a waterbody supports the aquatic life designated use.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`r Agency` uses multimetric macroinvertebrate indices, specifically the `r State` Multimetric Index (MMI) and the `r State` Coastal Plain Macroinvertebrate Index (CPMI), to assess the aquatic life use status of wadeable streams and rivers.  The MMI and the CPMI are applied to biomonitoring data collected in freshwater non-coastal areas and freshwater coastal areas, respectively. These indices utilize several biological metrics that are regionally calibrated to the appropriate reference condition (DEQa 2006; DEQ 2013).  Results are calculated into a single value, or score, that is sensitive to a wide range of stressors.  

##### Table 2.4-4. MMI/CPMI (`r IRrange`, n=`r max(filter(CDFdat,Subpopulation=='MiddleEarth'&Indicator=='MMI')$NResp)`) Scores compared to `r paste(State, "'s", sep="")` Assessment Thresholds.
```{r MMI summary}
#vlookup function and MMI dataset created in SSglobal, 60 is impairment threshold
#Creation of MMIsummary could be in SSglobal.R (Hab and pH are there)

MMIsummary <- data.frame(Parameter='MMI',
                         pct=vlookup(60,MMI,2,TRUE), 
                         MoE=vlookup(60, MMI, 3, TRUE)) %>%
               mutate(Parameter='MMI',
                      Below=paste(format(pct,digits=2,nsmall=1),'% (+/- ', format(MoE,digits=2,nsmall=1),'% )',sep='')) %>% #formatting and pasting pct and MoE together
               select(Parameter,Below)
names(MMIsummary) <- c('Parameter','Percentage of Stream Miles Below Standard')

knitr::kable(MMIsummary,align='c')
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MMI and CPMI scores were scaled for comparability in all analyses. Based on MMII and CPMI ProbMon results, `r Agency` estimates that `r format(vlookup(60,MMI,2,T),digits=1,nsmall=1)`% of `r State` streams and rivers do not meet the aquatic life use standard (Table 2.4-4, DEQ 2018). An estimate of statewide biological health by condition category is shown in Figure 2.4-4. MMI scores less than 42 are considered severely ecologically stressed, scores between 42 and 60 are moderately stressed, while sites above 60 to 72 are thought to have good ecological conditionals and sites with MMI scores above 72 are considered to have excellent water quality and habitat conditions  (DEQ, 2006a). It is important to remember that biological indicators represent long-term water quality conditions and respond to a variety of stressors. 

##### Figure 2.4-4. Biological stream condition based on MMI Scores (`r IRrange`, n = `r  max(filter(CDFdat,Subpopulation=='MiddleEarth'&Indicator=='MMI')$NResp)`).
```{r,fig.width=3.5, fig.height=2.75}
MMIcut <- data.frame(Stress=c('Severe Stress','Moderate Stress', 
                               'Good Condition','Excellent Condition'),
                      pct=c(vlookup(42,MMI,2,TRUE), #Severe
                            vlookup(60,MMI,2,TRUE)-vlookup(42,MMI,2,TRUE), #Moderate
                            vlookup(72,MMI,2,TRUE)-vlookup(60,MMI,2,TRUE), #Good
                            100-vlookup(72,MMI,2,TRUE))) #Excellent
MMIcut$Stress <- factor(MMIcut$Stress,levels = unique(MMIcut$Stress)) #for plotting

p2.4.5 <- ggplot(MMIcut,aes(Stress,pct,fill=Stress))+
  geom_bar(stat='identity',width=.6)+
  labs(x="Stream Condition Category", y = "Percent of Stream Miles")+
  scale_x_discrete(breaks=unique(MMIcut$Stress),
                   labels=addline_format(MMIcut$Stress))+ #addline_format function in SSglobal, to have x bar labels on two lines
  geom_text(aes(label=paste(format(pct,digits=2,nsmall=1),"%",sep="")), 
            vjust=1.6, color="black", size=3.5,family="Arial")+
  theme_minimal()+
  scale_fill_manual(values=c("#D55E00","#F0E442","#009E73","#0072B2"))+ #order of colors matters
  theme(legend.position="none", #no legend
        plot.title = element_text(hjust = 0.5), #center title
        text=element_text(family="Arial"),
        panel.grid.major.x = element_blank(),
        # explicitly set the horizontal lines (or they will disappear too)
        panel.grid.major.y = element_line( size=.1, color="black" ),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), # no background grid
        axis.line = element_line(colour = "black")) 
p2.4.5
```

#### Statewide Status

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The collection of probabilistic monitoring data from 2009 to present has generated a robust dataset with enough samples to analyze differences in bioloical condition by stream size, ecoregion, and major basins. This analysis illustrates the current status of `r State` waterways across various environmental classifications. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Changes in biological community are evident by grouping streams based on their size. For this analysis, streams were categorized as small, medium, and large based on the qualifications listed in Table 2.4-5. Figure 2.4-5 uses this stream size classification to compare percent of stream miles at or below the biological stream condition assessment threshold. Nearly half of all small and medium streams have moderately to severely stressed biological conditions. Large streams are significantly different relative to their smaller counterparts with just under a quarter of large wadeable stream miles falling below the biologic assessment threshold. This may suggest that larger streams have benefited from point source pollution controls, which are more common in larger watersheds, while smaller streams are adversely impacted by nonpoint source pollution. Nonpoint source pollution is more difficult to control due to its dispersed nature and is prevalent in both small and large steams. 

##### Table 2.4-5 Stream size categories.
```{r}
sizeorder <- data.frame(x=c('Small','Medium','Large'),
                        y=c('1,2,3','2,3,4','3,4,5'),
                        z=c('< 10','10 - 50','> 50'))
names(sizeorder) <- c('Size Category','Stream Order','Watershed Area (sq miles)')
knitr::kable(sizeorder,align='c')
```

##### Figure 2.4-5 MMI/CPMI status by stream size category. Percentile represents percent of stream miles below the biologic assessment threshold. The number of samples collected from `r IRrange` in each category is identified as n.
```{r, fig.width=3.5, fig.height=3}
small <- filter(CDFdat,Subpopulation=='Small'&Indicator=='MMI')%>%
  select(Value, Estimate.P, MoE.P,everything())
medium <- filter(CDFdat,Subpopulation=='Medium'&Indicator=='MMI')%>%
  select(Value,Estimate.P,MoE.P,everything())
large <- filter(CDFdat,Subpopulation=='Large'&Indicator=='MMI')%>%
  select(Value,Estimate.P, MoE.P,everything())

#vlookup function created in SSglobal.R
sizetrend <- data.frame(size=c('Small','Medium','Large'),
                        n=c(max(small$NResp),max(medium$NResp),max(large$NResp)),
                      MMIpct=c(vlookup(60,small,2,TRUE),
                               vlookup(60,medium,2,TRUE),
                               vlookup(60,large,2,TRUE)), 
                       MoE=c(vlookup(60,small,3,TRUE),
                            vlookup(60,medium,3,TRUE),
                            vlookup(60,large,3,TRUE)),
                      plotloc=10)

sizetrend$size <- factor(sizetrend$size,levels=c('Small','Medium','Large'))

psize <- ggplot(sizetrend,aes(size,MMIpct))+
  geom_bar(stat='identity', fill="steelblue",width=.65)+
  labs(x="Stream Size Category", y = "Percent of Stream Miles Below \nBiologic Assessment Threshold")+
  geom_text(aes(y=sizetrend$plotloc,#set position of text with plotloc value
                label=paste(format(MMIpct,digits=1,nsmall=1),"%",sep="")),
            color="black", size=3.5,family='Arial')+ 
  geom_text(aes(y=sizetrend$plotloc-5, #placing "n=" below MMIpct value (plotloc-5)
                label=paste('n =',sizetrend$n,sep=" ")),
            color="black", size=3.5,family='Arial')+
  theme_minimal()+
  theme(legend.position="none", # no legend
        plot.title = element_text(hjust = 0.5), #center title
        text=element_text(family="Arial"),
        panel.grid.major.x = element_blank(),
    # explicitly set the horizontal lines (or they will disappear too)
        panel.grid.major.y = element_line( size=.1, color="black" ),
        panel.grid.minor = element_blank(), # no background grid
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"))#+ 
      #theme(axis.text.x = element_text(angle = 45, hjust = 1))# rotate x axis text

psize+geom_errorbar(aes(ymax=MMIpct+MoE,ymin=MMIpct-MoE), position="dodge", width=0.15) 
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Evaluating biological condition by EPA Level III Ecoregions offers a different lens to analyze `r State` streams, grouping `r State`'s diverse geography based on similarities among environmental resources (Omernik 1987). Ecoregions are based on many factors including land use, land surface form, potential natural vegetation, and soils. An ecoregion is useful at the state level to understand the attainable ranges of aquatic ecosystems. Figure 2.4-6 illustrates percent of stream miles below the biological assessment threshold by `r State` ecoregions. Mordor has the highest percentage of stream miles that are considered moderately to severely stressed biologically. The Shire maintains the highest quality biologically and is significantly different than all other ecoregions in terms of stream miles below the biologic threshold. The Shire Ecoregion is known for dense, protected forests while Gondor has experienced a high degree of resource extraction.   

##### Figure 2.4-6 MMI status by EPA Level III Ecoregions. The percent of stream miles below the biologic assessment threshold is listed on the y axis. The number of samples collected from `r IRrange` in each ecoregion is identified as n.
*In this graph we manually set the positions of text labels for each bar*
```{r, fig.width=4.5, fig.height=3.5}
#Filter MMI CDF by Subpopulation
Mordor <- filter(CDFdat,Subpopulation=='Mordor'&Indicator=='MMI')%>% 
  select(Value,Estimate.P, MoE.P, everything())
Shire <- filter(CDFdat,Subpopulation=='Gondor' & Indicator=='MMI')%>% 
  select(Value,Estimate.P, MoE.P, everything())
Gondor <- filter(CDFdat,Subpopulation=='Shire' &Indicator=='MMI')%>%
    select(Value,Estimate.P, MoE.P, everything())

#Retrieve n and Look up threshold values for each subpopulation
Ecotrend <- data.frame(Eco=c('Mordor','Gondor','Shire'),
                 n=c(max(Mordor$NResp),max(Gondor$NResp),max(Shire$NResp)),
                 MMIpct=c(vlookup(60,Mordor,2,TRUE), #Need to look up in same order as Eco
                          vlookup(60,Gondor,2,TRUE),
                          vlookup(60,Shire,2,TRUE)),
                MoE=c(vlookup(60,Mordor,3,TRUE),
                      vlookup(60,Gondor,3,TRUE),
                      vlookup(60,Shire,3,TRUE)),
                plotloc=45)  #plotloc is used for geom_text plotting location

#In this graph, we manually set the position of text for every bar
#I had to use tiral and error to figure out text location for word document to look good
pEcotrend <- ggplot(Ecotrend,aes(Eco,MMIpct))+
  geom_bar(stat='identity',  fill="steelblue",width=.75)+
  labs(x="Ecoregions", y ="Percent of Stream Miles Below \nBiologic Assessment Threshold")+
  geom_text(data=subset(Ecotrend,Eco== 'Mordor'),
            aes(Eco, plotloc, #manually set position of text with plotloc value
                label=paste(format(MMIpct,digits=3,nsmall=1),"%",'\n','n = ',n,sep="")), 
                color="black", size=3.5,family='Arial')+ 
  geom_text(data=subset(Ecotrend,Eco == 'Gondor'),
             aes(Eco,plotloc-28, #manually set position in relation to plotloc (could just pick a different number)
                 label=paste(format(MMIpct,digits=3,nsmall=1),"%",'\n','n = ', n, sep="")),
                 vjust=-3.5, color="black", size=3.5,family='Arial')+ 
  geom_text(data=subset(Ecotrend,Eco=='Shire'),
            aes(Eco,plotloc-25, #manually set position in relation to plotloc
                label=paste(format(MMIpct,digits=2,nsmall=1),"%",'\n','n =',n,sep=" ")), 
                color="black", size=3.5,family='Arial')+
  theme_minimal()+ 
  theme(legend.position="none",
        plot.title = element_text(hjust = 0.5),#center title
        text=element_text(family="Arial"),
        panel.grid.major.x = element_blank(),
    # explicitly set the horizontal lines (or they will disappear too)
        panel.grid.major.y = element_line( size=.1, color="black" ),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"))+ # no background grid
        theme(axis.text.x = element_text(angle = 45, hjust = 1))# rotate x axis text

pEcotrend + geom_errorbar(aes(ymax=MMIpct+MoE,ymin=MMIpct-MoE), position="dodge", width=0.15)

```

```{r message=FALSE, warning=FALSE, include=FALSE}
##This is where you make your Basin (or other subpopulation) Dataframe (instead of Ecoregion)
#(I am just using the same data from the previous chunk)
basintrend<-Ecotrend %>%
  rename(basin=Eco)

####THIS WAS VA'S CODE
# chowan <-  filter(CDFdat,Subpopulation=='Chowan'&Indicator=='VSCIVCPMI')%>%
#   select(Value,Estimate.P,MoE,everything())
# rappahannock <-  filter(CDFdat,Subpopulation=='Rappahannock'&Indicator=='VSCIVCPMI')%>%
#   select(Value,Estimate.P,MoE,everything())
# york <-  filter(CDFdat,Subpopulation=='York'&Indicator=='VSCIVCPMI')%>%   
#   select(Value,Estimate.P,MoE,everything())
# potomac <-  filter(CDFdat,Subpopulation=='Potomac'&Indicator=='VSCIVCPMI')%>%   
#   select(Value,Estimate.P,MoE,everything())
# shenandoah <-  filter(CDFdat,Subpopulation=='Shenandoah'&Indicator=='VSCIVCPMI')%>%  
#   select(Value,Estimate.P,MoE,everything())
# roanoke <-  filter(CDFdat,Subpopulation=='Roanoke Basin'&Indicator=='VSCIVCPMI')%>%   
#   select(Value,Estimate.P,MoE,everything())
# james <-  filter(CDFdat,Subpopulation=='James Basin'&Indicator=='VSCIVCPMI')%>%   
#   select(Value,Estimate.P,MoE,everything())
# new <-  filter(CDFdat,Subpopulation=='New'&Indicator=='VSCIVCPMI')%>%  
#   select(Value,Estimate.P,MoE,everything())
# bigsandy <-  filter(CDFdat,Subpopulation=='Big Sandy'&Indicator=='VSCIVCPMI')%>% 
#   select(Value,Estimate.P,MoE,everything())
# cp <-  filter(CDFdat,Subpopulation=='Clinch-Powell'&Indicator=='VSCIVCPMI')%>% 
#   select(Value,Estimate.P,MoE,everything())
# holston <-  filter(CDFdat,Subpopulation=='Holston'&Indicator=='VSCIVCPMI')%>% 
#   select(Value,Estimate.P,MoE,everything())
# 
# 
# basintrend <- data.frame(basin=c('Chowan','Rappahannock','York','Potomac','Shenandoah','Roanoke','James',
#                                       'New','Big Sandy','Clinch-Powell','Holston'),
#                           n=c(max(chowan$NResp),max(rappahannock$NResp),max(york$NResp),max(potomac$NResp),max(shenandoah$NResp),max(roanoke$NResp),
#                               max(james$NResp),max(new$NResp),max(bigsandy$NResp),max(cp$NResp),max(holston$NResp)),
#                          VSCIpct=c(vlookup(60,chowan,2,TRUE),vlookup(60,rappahannock,2,TRUE),
#                                 vlookup(60,york,2,TRUE),vlookup(60,potomac,2,TRUE),vlookup(60,shenandoah,2,TRUE),
#                                 vlookup(60,roanoke,2,TRUE),vlookup(60,james,2,TRUE),
#                                 vlookup(60,new,2,TRUE),vlookup(60,bigsandy,2,TRUE),vlookup(60,cp,2,TRUE),
#                                 vlookup(60,holston,2,TRUE)),
#                          LCB=c(vlookup(60,chowan,3,TRUE),vlookup(60,rappahannock,3,TRUE),
#                                 vlookup(60,york,3,TRUE),vlookup(60,potomac,3,TRUE),vlookup(60,shenandoah,3,TRUE),
#                                 vlookup(60,roanoke,3,TRUE),vlookup(60,james,3,TRUE),
#                                 vlookup(60,new,3,TRUE),vlookup(60,bigsandy,3,TRUE),vlookup(60,cp,3,TRUE),
#                                 vlookup(60,holston,3,TRUE)),
#                          UCB=c(vlookup(60,chowan,4,TRUE),vlookup(60,rappahannock,4,TRUE),
#                                 vlookup(60,york,4,TRUE),vlookup(60,potomac,4,TRUE),vlookup(60,shenandoah,4,TRUE),
#                                 vlookup(60,roanoke,4,TRUE),vlookup(60,james,4,TRUE),
#                                 vlookup(60,new,4,TRUE),vlookup(60,bigsandy,4,TRUE),vlookup(60,cp,4,TRUE),
#                                 vlookup(60,holston,4,TRUE)),plotloc=30)
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In `r State`, we do not have separate basins and ecoregions.  But, we could also display biological condition by major basins, presented in a bar chart similar to graphics previously discussed. Figure 2.4-7 illustrates the differences in biological condition across `r State` theoretical basins as the percent of rivermiles below the biologic assessment threshold. One of three major basins in `r State`, Mordor, has well over 50% of stream miles under moderate to severe biological stress. One of the major basins has between 25 to 50% of stream miles below the biological standard. The Shire basin has the fewest stream miles with moderate to severe biological stress at only `r format(filter(basintrend,basin=='Shire')$MMIpct,digits=2,nsmall=1)`%.

*This next graph (Figure 2.4-7) will be the same as MMI status by ecoregions (2.4-6). (In my data, I'm pretending basins are the same as ecoregions).  However, we made the location of the text labels for every bar the same, except for the Shire.*

######

##### Figure 2.4-7 MMI status by major `r State` basins. The percent of stream miles below the MMI assessment threshold is listed on the y axis. The number of samples collected from 2009 - `r IRyearWindowEnd` in each basin is identified as n.


```{r,fig.width=4.5, fig.height=3.5}

#This graph separates out the Shire label position because it's the only one different
#It also uses two different geom_texts, one for percent and one for n=
#This took trial an error with the text labels to make them look decent in the word output doc

pbasintrend <- ggplot(basintrend,aes(basin,MMIpct))+
    geom_bar(stat='identity', fill="steelblue",width=.95)+
    labs(x="Major Basin", y = "Percent of Stream Miles Below \nBiologic Assessment Threshold")+
  #percent label, not shire  
    geom_text(data=subset(basintrend,basin!= 'Shire'), 
              aes(basin,25,label=paste(format(MMIpct,digits=2,nsmall=1),"%",sep="")),
              vjust=4.0, color="black", size=3.5)+ 
  #percent label, shire  
    geom_text(data=subset(basintrend,basin ==  'Shire'), 
              aes(basin,-2,label=paste(format(MMIpct,digits=2,nsmall=1),"%",sep="")),
              vjust=-3.8, hjust=-0.75, color="black", size=3.5)+ 
  #'n=' label, not Shire  
    geom_text(data=subset(basintrend,basin!= 'Shire'),
              aes(basin,25-1,label=paste('n=',n,sep="")), 
              vjust=5.1, color="black", size=3.5,family='Arial')+ #vjust is higher, so it appears lower than % label
    #'n=' label, Shire 
    geom_text(data=subset(basintrend,basin == 'Shire'),
              aes(basin,-2,label=paste('n=',n,sep="")), 
              vjust=-2.8, hjust=-0.75, color="black", size=3.5,family='Arial')+#'vjust is higher than vjust for %, so it appears lower than % label
    theme_minimal()+
    theme(legend.position="none",
          plot.title = element_text(hjust = 0.5), #center title
          text=element_text(family="Arial"),
          panel.grid.major.x = element_blank(),
    # explicitly set the horizontal lines (or they will disappear too)
          panel.grid.major.y = element_line( size=.1, color="black" ),
          panel.grid.minor = element_blank(),
          panel.background = element_blank(),
          axis.line = element_line(colour = "black"))+ # no background grid
          theme(axis.text.x = element_text(angle = 45, hjust = 1))# rotate x axis text

pbasintrend + geom_errorbar(aes(ymax=MMIpct+MoE,ymin=ifelse(MMIpct-MoE>0, MMIpct-MoE, 0)), position="dodge", width=0.15)

```



### 2.4.5 Parameters without Water Quality Standards

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stressors that increase the risk to benthic macroinvertebrate communities and do not have specific water quality standards include streambed sedimentation, habitat degradation, nutrients, ionic strength, and water column cumulative metals. Thresholds for the aforementioned stressors are presented in Tables 2.4-6 and 2.4-7 and are derived from literature values. The optimal classification represents water quality conditions that are not associated with degraded aquatic communities. Stressors classified as suboptimal increase the likelihood of finding an impacted aquatic community. The condition class between optimal and suboptimal is termed fair as the stress to the aquatic community is less certain. In the following examples, water quality parameters without regulatory standards or criteria are presented using barplots. The barplots represent estimates drawn from data in the `r IRyear` Integrated Report sample window (`r IRrange`). 

##### Table 2.4-6. Thresholds of condition classes for biological indicators.
```{r}
bioindicators <- data.frame(resp=c('Multimetric Macroinvertebrate Index','Coastal Plain Macoinvertebrate Index'),
                          optimal=c('> 60','> 40'),
                          Suboptimal=c('<50','<30'),
                          classref=c('(VDEQ 2006a)','(VDEQ 2013)'))
names(bioindicators) <- c('Response Parameters','Optimal','Suboptimal','Classification Reference')
knitr::kable(bioindicators,align='c')
```


######

##### Table 2.4-7. Thresholds of condition classes for stressor indicators[^2].
```{r}
stressparams <- data.frame(stress=c('Total Nitrogen (mg/L)','Total Phosphorus (mg/L)','Habitat Degradation (unitless)','Streambed Sedimentation (unitless)','Ionic Strength (TDS mg/L)','Cumulative Dissolved Metals (unitless)'),
                           Optimal=c('< 1','< 0.02','> 150','> -0.5','< 100','< 1'),
                           Suboptimal=c('> 2','> 0.05','< 120','< -1.0','> 350','> 2'),
                           classref=c('(DEQ 2006a)','(DEQ 2006a)','(USEPA 1999)','(Kaufmann 1999)','(DEQ 2006b)','(Clements 2000)'))

names(stressparams) <- c('Stressor Parameters','Optimal','Suboptimal','Classification Reference')

knitr::kable(stressparams,align='c')
```

[^2]:The relative risk screening values presented in Tables 2.4-7 do not represent water quality criteria nor are intended for establishing TMDL endpoints. The values represent an increase in the probability of stress to benthic communities. 

#### Habitat Disturbance

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Habitat is defined as the area or environment where an organism resides. It encompasses its surroundings, both living and non-living. Fish, aquatic insects, and plants require certain types of habitat to thrive, so in-stream and riparian (stream bank) habitat is evaluated when a biomonitoring sample is collected. Because different organisms have diverse habitat requirements, a variety of available habitat types in a stream or river will support a diverse aquatic community. Habitat is scored by evaluating ten habitat parameters and adding them together (total scores range from 0 to 200). Habitat scores above 150 indicate habitat conditions favorable for supporting a healthy aquatic community and are considered optimal. Scores lower than 120 are considered suboptimal and scores between 120 and 150 are fair (EPA 1999). As indicated in Figure 2.4-8, `r Agency` estimates that slightly over `r format(100-vlookup(150,hab,2,TRUE),digits=2,nsmall=0)`% of stream and river miles have available habitat that is considered optimal.

##### Figure 2.4-8. Estimate of Habitat Condition in `r State` Streams and Rivers. Data presented is from 2009 - 2014 (n = `r  max(filter(CDFdat,Subpopulation=='MiddleEarth'&Indicator=='TotHab')$NResp)``).
```{r, fig.width=3, fig.height=2.25}
p2.4.10 <- ggplot(totalshab,aes(Condition,pct,fill=Condition))+ #totalshab created in SSglobal
  geom_bar(stat='identity',width=.5)+
  labs(x="Stream Condition Category", y = "Percent of Stream Miles")+
  geom_text(aes(label=paste(format(pct,digits=1,nsmall=1),"%",sep="")),
            vjust=1.6, color="black", size=3.5,family='Arial')+
  scale_fill_manual(values=c("#D55E00","#F0E442","#009E73"))+
  theme_minimal()+
  theme(legend.position="none",
        plot.title = element_text(hjust = 0.5), # no legend, center title
      text=element_text(family="Arial"),
      # explicitly set the horizontal lines (or they will disappear too)
      panel.grid.major.x = element_blank(),
      panel.grid.major.y = element_line( size=.1, color="black" ),
      panel.grid.minor = element_blank(),
      panel.background = element_blank(),
      axis.line = element_line(colour = "black")) # no background grid
p2.4.10
```


### 2.4.6 Stressor Extent and Relative Risks

*See Supplement if you would like to include this in your report*

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;One of the advantages of probabilistic datasets is the ability to calculate the stressor extent (Figure 2.4-9, Figure 2.4-10), and relative risks (Figure 2.4-11) that different environmental stressors have on the ecological health of rivers and streams across large regions. Since the stations are selected at random, `r Agency` can estimate water quality parameter values over the entire state with known confidence. USEPA and other states have employed stressor extent and relative risk concepts extensively in their reports (DEQ 2007; USEPA 2006; Van Sickle 2006; Van Sickle 2008).

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stressor extent shows how prevalent a stressor is in `r State` streams. Calculation of relative risk requires classification of water quality responses (e.g. the benthic macroinvertebrate indices Table 2.4-6) and the water quality stressors (Table 2.4-8) into optimal and suboptimal categories. `r Agency` classified biological response parameters based on the aquatic life use standard. The stressor indicators in Table 2.4-8 were classified using screening values from peer reviewed literature studies. It is important to remember that the stressor screening values are not equivalent to water quality standards in the `r State`. This data-intensive statistical technique requires the entire probabilistic monitoring dataset (2009 - 2016).

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Relative risk is a term borrowed from the medical field and applied here to communicate the severity of impact a stressor has on the aquatic environment. For example, it has been shown that an individual with total cholesterol above 240 mg/dl is at greater risk for heart disease than an individual whose cholesterol is below 200 mg/dl. When an individual has a cholesterol level above 240, their relative risk of having heart disease is higher than an individual with cholesterol level below 200.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The relative risks for aquatic stressors can be interpreted in a similar manner to the heart disease example. Figure 2.4-24 illustrates that the relative risk to the biological community due to habitat disturbance is 5.0; thus, the biological community is 5.0 times more likely to be considered suboptimal when habitat disturbance scores are below 120 (USEPA 1999). Relative risk values larger than 1 indicate an elevated risk to the biological community; consequently, only water quality stressors with a relative risk greater than 1 are reported in this chapter. pH was also evaluated for increased risk to the biological community but did not show significant relative risk to the biological community.


##### Figure 2.4-9. Stressor extent for major benthic macroinvertebrate stressors in `r State` streams. The horizontal lines associated with the parameters illustrate the confidence intervals. Stressor extent shows the frequency of the stressor in all `r State` streams from data collected for the `r IRyear` Integrated Report (`r IRrange`). 

*This requires an additional dataset discussed in the supplement*


Figure 2.4-11. Relative Risk for major benthic macroinvertebrate stressors in all Middle Earth streams. The horizontal lines associated with the parameters illustrate the confidence intervals. The vertical dashed line at 1 indicates significance; thus, all relative risk estimates and confidence intervals that exceed the dashed vertical are significant. Relative risk shows the number of times more likely a benthic macroinvertebrate community is to be scored in the suboptimal range if the parameter shown on the y-axis is degraded. Data encompasses samples collected from 2001 - `r IRyearWindowEnd`.

*This requires an additional dataset discussed in the supplement*

##### Figure 2.4-10. Stressor extent for major benthic macroinvertebrate stressors in all `r State` streams (`r IRrange`) showing all condition classes (optimal, fair, and suboptimal). Optimal condition estimates are shown in green, fair condition estimates are yellow, and suboptimal conditions are shown in red. 

*This requires an additional dataset discussed in the supplement*

### 2.4.7 Uses of Probabilistic Data

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In addition to estimating the condition of all streams and rivers compared to established water quality criteria/screening values and identifying the major stressors to aquatic organisms, freshwater ProbMon data has many ancillary applications within water quality management programs. Examples of these uses are discussed below. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProbMon data is used in describing both the natural and baseline conditions of `r State` streams. In addition, ProbMon has helped identify minimally disturbed streams and understand their natural variability.  This information is integral for `r Agency` to develop more regionally specific water quality expectations and in turn define reference conditions and select appropriate reference sites.  ProbMon has also provided statistically defensible descriptions of stream conditions as of the beginning of this century.  `r Agency` will find this baseline tremendously valuable for comparison in future assessments.  

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProbMon data is currently being used by an in the stressor identification process in benthic macroinvertebrate TMDLs (DEQ 2017).  Stressor analysis is the process whereby candidate causes of stress (or stressors) to benthic macroinvertebrate communities are evaluated. The purpose of the workgroup was to develop data collection recommendations and scientifically defensible screening values for categorizing potential stressors. ProbMon data is especially useful in describing statewide in-stream conditions for those parameters that do not currently have water quality standards. Understanding existing conditions for those parameters without water quality standards provides perspective on parameter data and a way to evaluate potential stressors. Relative Bed Stability and metals in water column CCU are examples of new tools that are applicable to benthic macroinvertebrate TMDL stressor analysis. Relative Bed Stability is currently being utilized to evaluate sedimentation as a candidate stressor. ProbMon data was used to develop stressor specific metrics to help TMDL staff identify stressor signals from impaired reaches and collect the appropriate water chemistry information. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The collocation of biological, chemical, habitat and landuse data at ProbMon sites also allows for the examination of multiple stressors such as dissolved metal CCUs.  `r Agency` plans to explore the effects of multiple stressors in future reports.  This information should aid TMDL development and provide insight into how biological communities and stressor parameters interact.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProbMon data is also being used as a test platform for new monitoring approaches such as periphyton and fish community data collection. The collection methodology was designed and tested in tandem with the USEPA's National Aquatic Resource Survey (NARS).  Until `r Agency` participated in the NARS sampling, habitat and biology data collection methodologies were not refined for large rivers. Now `r Agency` is collecting complete ProbMon data sets for large rivers and plans to report on the condition of this valuable freshwater resource.  Because ProbMon provides biological, chemical, physical habitat, and land use information at each site, the data set is indispensable for developing and improving biomonitoring tools. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The ProbMon dataset provided crucial data needed to fill in gaps during the development of the MMI and the validation of both the MMI and Coastal Plain Macroinvertebrate Index (CPMI) (Maxted 2000). Following the validation, MMI assessment results were included in the 2008 Integrated Report. `r Agency` used ProbMon data to validate the CPMI. Specifically, ProbMon data was utilized to identify new reference sites in the coastal plain, check ecoregion best standard values, and select potential metrics that would help the CPMI detect benthic macroinvertebrate community stresses created by human activity. The effort resulted in a new, robust tool for evaluating benthic macroinvertebrate communities in the coastal plain regions of the Commonwealth called the `r State` Coastal Plain Macroinvertebrate Index (MCPMI, DEQ 2013).  The technical MCPMI document is online [here](https://www.epa.gov/national-aquatic-resource-surveys) . ProbMon also aided in improving the biomonitoring program by identifying over 100 new biological references sites, doubling the number of reference sites in the `r State` reference site database. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProbMon sites are the platform for building a genus-level macroinvertebrate database which may ultimately be used in developing a more robust multimetric assessment tool. ProbMon data may also be used to create a biological condition gradient for `r State` stream and rivers. The biological condition gradient is a descriptive model that illustrates how increasing stress alters ecological attributes (Davies and Jackson 2006). A biological condition gradient defines expected conditions, like benthic macroinvertebrate community structure, for streams by stream order and ecoregion. The biological condition gradient may help `r Agency` protect high-quality streams and provide stepwise interim goals for tracking water quality improvement. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Probabilistic data has been used to support water quality permitting decisions. `r Agency` establishes defensible background conditions in dissolved metal permit model by using the statistically derived baseline metal estimates for watersheds across the Commonwealth. A workgroup has been formed to help deliver this information to the water permitting group at `r Agency`.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An important future application of ProbMon data is change analysis (Kincaid 2016). `r Agency` adjusted the experimental design of ProbMon by adding randomly selected sentinel sites in order to accelerate its ability to detect changes in population estimates.  By revisiting a relatively small number of these randomly located sites each year, `r Agency` will be able to detect statewide and regional chemical, habitat, and biological changes.  Perhaps the most important question a monitoring program addresses is: are management initiatives effective?  The ability of ProbMon to detect shifts in populations estimates is critical to the goal of evaluating the effectiveness of water quality management programs.   


### 2.4.8 Conclusion

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`r Agency` analyzed several water quality parameters with established water quality criteria and/or screening values and one parameters without water quality criteria. Most of the parameters that have water quality criteria meet applicable standards. The majority of water quality standard exceedences are attributed to legacy pollutants or natural conditions. The results presented in the ProbMon chapter reflect the success of `r Agency`'s management of water quality parameters with water quality criteria. 
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Only biological monitoring results were found to be below screening thresholds in a relatively high percentage of streams. Benthic macroinvertebrate communities were degraded in `r format(filter(paramsummary, Parameter=='MMI\n(Biomonitoring)')$pct,digits=3)`% of the wadeable streams and rivers in `r State`; a percentage that could be considered widespread. Benthic macroinvertebrate communities are indicators of water quality problems because they respond to a variety of water quality stressors including parameters that have water quality standards (e.g. dissolved oxygen levels) and parameters that do not have criteria (e.g. such as nutrients and sedimentation).  The following six stressors increase the risk to aquatic organisms and do not currently have water quality standards: streambed sedimentation, habitat disturbance, total phosphorus, total nitrogen, total dissolved solids, and cumulative metals in water column.  These parameters are discussed in Section 2.4.5. These six major stressors do not currently have water quality standards, but most are being addressed through a variety of strategies such as nutrient management plans and best management practices.  As the ProbMon program evolves and `r Agency` expands on the uses of ProbMon data, enhancement of the strategies for understanding, evaluating and restoring `r State`'s streams and rivers will continue. 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Presentations, posters, reports, and handouts about ProbMon are available for viewing and download at the following website: http://www.deq.Virginia.gov/Programs/Water/WaterQualityInformationTMDLs/WaterQualityMonitoring/ProbabilisticMonitoring.aspx.

##Part 2: Graphs based on Categorical Condition Results

*This fake data is derived from NRSA data*

#### Nutrients

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nutrients are substances assimilated by living organisms that promote growth. Nitrogen and  phosphorus are the two most important nutrients in `r State` streams and rivers. Excess nutrients can stimulate in-stream plant and algal growth. Characteristics of nutrient enriched streams may include low dissolved oxygen, frequent fish kills, shifts in aquatic communities, and blooms of nuisance algae. Nutrients may come from fertilized lawns and cropland, failing septic systems, municipal and industrial discharges, and/or livestock manure.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The values of Total Nitrogen that can result in undesirable algae growth and shifts in aquatic communities varies by ecoregion. `r Agency` estimates that only `r round(filter(CatData,Subpop=='Middle Earth'&Indicator=='Nitrogen_Conc_Class'&Category=='< 100')$Estimate.P, digits=1)`% of stream and river miles are considered optimal (< 0.1 mg/L) for total nitrogen.   

```{r Remove Total from CatData, message=FALSE, warning=FALSE, include=FALSE}
CatData<-CatData %>%
  filter(Category!='Total')
```

```{r Calculate number of samples for each indicator, message=FALSE, warning=FALSE, include=FALSE}
#If you want to use number of samples in text, you can calculate them here

#Nitrogen Condition Class ####
ncc<-CatData %>% filter(Indicator=="Nitrogen_Conc_Class"&Subpop=='Middle Earth') %>%
  mutate(MoE=StdError.P*1.96)
  Nrep<-sum(ncc$NResp) 
  
#Fish data###
  fishdata<-CatData %>% filter(Indicator=="Fish_MMI"&Subpop=="Middle Earth") %>%
  mutate(MoE=StdError.P*1.96)
  
  FishNrep<-sum(fishdata$NResp)
```


##### Figure 2.4-12. Estimated Total Nitrogen Concentrations (percent of stream miles) in `r State`
```{r NCC Categorical Condition Chart, fig.width=7, fig.height=3.5}
ncc<-CatData %>% filter(Indicator=="Nitrogen_Conc_Class"&Subpop=='Middle Earth') %>%
  mutate(MoE=StdError.P*1.96)
  Nrep<-sum(ncc$NResp) 

#Change units to mg/L
  ncc$Category<-case_when(
        ncc$Category=="< 100"        ~ "< 0.1",
        ncc$Category=="100 - 1000"   ~ "0.1-1.0",
        ncc$Category=="1000 - 10000" ~ "1.0-10.0",
        ncc$Category=="> 10000"      ~ "> 10.0"
      )
  
  #For manual color scale
valuesncc=c("#0072B2", "#F0E442", "#CC79A7", "#D55E00") #for ColScale
labelsncc=c("< 0.1 mg/L", "0.1-1.0 mg/L", "1.0-10.0 mg/L", "> 10.0 mg/L" ) #for ColScale
levelsncc=c("< 0.1", "0.1-1.0", "1.0-10.0", "> 10.0") #for factor, needed to order properly

#Data Plot ####
  CatState<- levelsncc %in% ncc$Category #true false vector of which categories are present in the selected data
  
  ncc$Category=factor(ncc$Category, levels=rev(levelsncc[CatState])) #defining factors to set order of bars on chart
  colScale1<-scale_fill_manual(name="Concentration Class  (mg/L)", values=rev(valuesncc[CatState]), labels=rev(labelsncc[CatState])) #for legend
  
ggplot(ncc, aes(x=Category, y=Estimate.P))+
    geom_bar(aes(fill=Category), position="dodge", stat="identity")+
    geom_errorbar(aes(ymin=Estimate.P-MoE, ymax=Estimate.P+MoE), width=.2,
                  position=position_dodge(.9))+ 
    geom_text(aes(label=paste(format(Estimate.P,digits=1,nsmall=1),"% +/- ",
              format(MoE,digits=1,nsmall=1),"%",sep=""),y=70),size=3,family="Arial")+
    labs(x="Concentration Class  (mg/L)")+
    ylab("Percent of Population") +
    ggtitle(("Middle Earth Nitrogen Concentration"), 
            subtitle=paste("Sample Size =", Nrep, sep=" "))+
    colScale1+
    coord_flip(ylim=c(0, 72))+
    theme(text=element_text(family="serif"),
          plot.title = element_text(hjust = 0.5, size=12, face="bold"),
          plot.subtitle = element_text(hjust = 0.5, size=10),
          axis.text=element_text(color="#000000"),
          axis.title=element_text(face="bold"),
          legend.position = "none")

```

##### Figure 2.4-13. Estimated Total Nitrogen Concentrations (percent of stream miles) by Geographic Area in `r State`
```{r NCC stacked bar chart, fig.width=7, fig.height=4}
## Play with stacked bar charts
nccstacked<-CatData %>% filter(Indicator=="Nitrogen_Conc_Class")

#Change units to mg/L
  nccstacked$Category<-case_when(
        nccstacked$Category=="< 100"        ~ "< 0.1",
        nccstacked$Category=="100 - 1000"   ~ "0.1-1.0",
        nccstacked$Category=="1000 - 10000" ~ "1.0-10.0",
        nccstacked$Category=="> 10000"      ~ "> 10.0"
      )

#For manual color scale
      values=c("#56B4E9", "#F0E442", "#CC79A7", "#D55E00") #for ColScale
      labels=c("< 0.1", "0.1-1.0", "1.0-10.0", "> 10.0" )
      levels=c("< 0.1", "0.1-1.0", "1.0-10.0", "> 10.0")
      name="Concentration Class (mg/L)"
      
      title<-"TN Concentration by Geographic Area"

    nccstacked$Category=factor(nccstacked$Category, levels=levels)  
    colScale1<-scale_fill_manual(name=name, values=values, labels=labels)

#For order of bars on chart      
    subpoplevels<-c("Mordor", "Gondor", "Shire", "Middle Earth") 
    nccstacked$Subpop=factor(nccstacked$Subpop, levels=subpoplevels) 

#Plot
ggplot(nccstacked,aes(Subpop,Estimate.P,fill=Category,label=Estimate.P))+
      geom_bar(stat='identity',width=.5)+
      labs(x="Geographic Area", y = "Percent of Population")+
      coord_flip()+
      scale_x_discrete(breaks=nccstacked$Subpop,labels=addline_format(nccstacked$Subpop))+
      scale_y_reverse()+ #Making order of legend and bar chart colors match
      geom_text(aes(label=paste(format(Estimate.P,digits=1,nsmall=1),"%",sep="")),
                size=3,family='serif',position=position_stack(vjust=0.5))+
      theme_minimal()+
      ggtitle(title)+
      colScale1+ #scale_fill_manual above
      theme(text=element_text(family="serif"),
            axis.text.x=element_blank(), #Remove number on x  axis
            axis.title=element_text(face="bold"),
            plot.title = element_text(hjust = 0.5, size=12, face="bold"),
            plot.subtitle = element_text(hjust = 0.5, size=10),
            legend.position="bottom",
            panel.grid.major.x = element_blank(), 
            panel.grid.minor = element_blank(),panel.background = element_blank(),
            axis.line = element_line(colour = "black"))+# no background grid
      theme(plot.margin=unit(c(0,1,0,0),'cm'))    
      
      
```

#### Biological Monitoring

Biological monitoring, or biomonitoring, of streams and rivers is an integral component of DEQ's water quality monitoring program. Biomonitoring allows DEQ to assess the overall ecological condition of streams and rivers by evaluating stream condition with respect to suitability for support of aquatic communities. In Middle Earth, fish communities are used as one indicator of ecological condition and to address the question of whether a waterbody supports the aquatic life designated use.

DEQ uses multimetric fish indices, specifically the MEMMI to assess the aquatic life use status of wadeable streams and rivers. The MEMMI is applied to biomonitoring data collected in freshwater non-coastal areas. These indices utilize several biological metrics that are regionally calibrated to the appropriate reference condition. Results are calculated into a single value, or score, that is sensitive to a wide range of stressors.

##### Figure 2.4-14. Estimated Fish Condition (percent of stream miles) in `r State`
```{r Fish MMI Cat Plot, fig.width=7, fig.height=3.5}
## Fish MMI ####
 data<-CatData %>% filter(Indicator=="Fish_MMI"&Subpop=="Middle Earth") %>%
  mutate(MoE=StdError.P*1.96)
  
Nrep<-sum(data$NResp)

#For defining factors and color scales
    values=c("#56B4E9", "#F0E442", "#D55E00", "#999999")
    labels=c("Good", "Fair", "Poor", "Not Assessed")
    levels=c("Good", "Fair", "Poor", "Not Assessed")
    name="Condition Category"
    title="Fish MMI"

    #true false vector of which categories are present in the selected data.  If you don't think this will change between surveys, you could skip this
  CatState<- levels %in% data$Category 
  
  data$Category=factor(data$Category, levels=rev(levels[CatState])) #order of bars
  colScale1<-scale_fill_manual(name=name, values=rev(values[CatState]), labels=rev(labels[CatState])) #for legend
  
ggplot(data, aes(x=Category, y=Estimate.P))+
    geom_bar(aes(fill=Category), position="dodge", stat="identity")+
    geom_errorbar(aes(ymin=Estimate.P-MoE, ymax=Estimate.P+MoE), width=.2,
                  position=position_dodge(.9))+ 
    geom_text(aes(label=paste(format(Estimate.P,digits=1,nsmall=1),"% +/- ",
                  format(MoE,digits=1,nsmall=1),"%",sep=""),y=44),size=3,family="Arial")+
    labs(x="Condition Category")+
    ylab("Percent of Population") +
    ggtitle(paste(data$Subpopulation[1], title, sep=" "), 
            subtitle=paste("Sample Size =", Nrep, sep=" "))+
    colScale1+
    coord_flip(ylim=c(0, 45))+
    theme(text=element_text(family="serif"),
          plot.title = element_text(hjust = 0.5, size=12, face="bold"),
          plot.subtitle = element_text(hjust = 0.5, size=10),
          axis.text=element_text(color="#000000"),
          axis.title=element_text(face="bold"),
          legend.position="none")

```

##### Figure 2.4-15. Estimated Fish Condition (percent of stream miles) accross `r State` geographic areas.
```{r Fish MMI Stacked Plot, fig.width=7, fig.height=4}
StackedData<-CatData %>% filter(Indicator=="Fish_MMI")

#For manual color scale
    values=c("#56B4E9", "#F0E442", "#D55E00", "#999999")
    labels=c("Good", "Fair", "Poor", "Not Assessed")
    levels=c("Good", "Fair", "Poor", "Not Assessed")
    name="Condition Category"
    title="Fish MMI"

    StackedData$Category=factor(StackedData$Category, levels=levels)  
    colScale1<-scale_fill_manual(name=name, values=values, labels=labels)

#For order of bars on chart
    subpoplevels<-c("Mordor", "Gondor", "Shire", "Middle Earth")
    StackedData$Subpop=factor(StackedData$Subpop, levels=subpoplevels) 

#Plot
ggplot(StackedData,aes(Subpop,Estimate.P,fill=Category,label=Estimate.P))+
  geom_bar(stat='identity',width=.5)+
  labs(x="Geographic Area", y = "Percent of Stream Miles")+ 
  coord_flip()+
  scale_x_discrete(breaks=StackedData$Subpop,labels=addline_format(StackedData$Subpop))+
  geom_text(aes(label=paste(format(Estimate.P,digits=1,nsmall=1),"%",sep="")),
            size=3,family='Arial',position=position_stack(vjust=0.5))+
  theme_minimal()+
  colScale1+
  scale_y_reverse()+ #Making order of legend and bar chart colors match
  theme(text=element_text(family="Arial"),
        panel.grid.major.x = element_blank(),
        # explicitly set the horizontal lines (or they will disappear too)
        panel.grid.major.y = element_line( size=.1, color="black" ),
        panel.grid.minor = element_blank(),panel.background = element_blank(),
        axis.line = element_line(colour = "black"), # no background grid
        plot.margin=unit(c(0,1,0,0),'cm'),
        legend.position="bottom")# no legend
```


### 2.4.9 References

Clements, W.H., D.M. Carlisle, J.M. Lazorchak, and P.C. Johnson. 2000. Heavy Metals Structure Benthic Communities in Colorado Mountain Streams. Ecological Applications 10(2):626-638. 

Commonwealth of MiddleEarth.  2017.  Water Quality Standards (9 MEC 25-260-00 et seq.).  Department of Environmental Quality, Shire. http://lis.Middle Earth.gov/cgi-bin/legp604.exe?000+reg+9VAC25-260.

Davies, S.P. and S.K. Jackson. 2006. The Biological Condition Gradient: a descriptive model for interpreting change in aquatic ecosystems. Ecological Applications 16 (4), 1251-1266.

Diaz-Ramos, S., D.L. Stevens, Jr., and A.R. Olsen 1996.  EMAP Statistics Methods Manual. EPA/620/R-96/002. 	Corvallis, OR: U.S. Environmental Protection Agency, Office of Research and Development, National 	Health and Environmental Effects Research Laboratory.  [see http://www.epa.gov/nheerl/arm/ for 	downloadable file]

Kaufmann, P. R., John M. Faustini, David P. Larsen,  and Mostafa A. Shirazia. 2008. A roughness-corrected index of relative bed stability for regional stream surveys. Geomorphology. Volume 99, Issues 1-4, 1 July 2008, Pages 150-170.

Kaufmann, P. R., P. Levine, E. G. Robinson, C. Seeliger, and D. Peck. 1999. Quantifying physical habitat in wadeable streams. EPA/620/R-99/003, USEPA, Washington, D.C.

Kincaid, T. M. and Olsen, A. R. 2016. spsurvey: Spatial Survey Design and Analysis. R package version 3.3.

MacDonald, D.D. and C.G. Ingersoll, T.A. Berger. 2000. Development and Evaluation of Consensus-Based 	Sediment Quality Guidelines for Freshwater Ecosystems. Arch. Envorin. Contam. Toxicology 39:20-31.

Maxted, J. M. Barbour, J. Gerritsen, V. Poretti, N. Primrose, A. Silvia, D. Penrose, and R. 	Renfrow. 2000. Assessment framework for mid-Atlantic coastal plain streams using benthic macroinvertebrates. The North American Benthological Sociey 19(1), 128-144.

Omernik, James. 1987. Ecoregions of the Conterminous United States. Annuals of the Association of American Geographers. Volume 77, Issue 1, March 1987, Pages 118125.

Oregon Department of Environmental Quality. 2007. Wadeable Stream Conditions in Oregon. Oregon Department of Environmental Quality, Laboratory Division, Watershed Assessment Section. DEQ07-LAB-0081-TR. 

Paul, J.F. and M.E. McDonald. 2005. Development of Empirical, Geographically Specific Water Quality Criteria:	 A Conditional Probability Analysis Approach. Journal of the American Water Resources Association (JAWRA) 41(5):1211-1223.

R Core Team. 2017. R: A language and environment for statistical computing. R Foundation for Statistical
Computing, Vienna, Austria. URL https://www.R-project.org/.

Stevens, D.L, Jr. 1997. Variable Density Grid-Based Sampling Designs for Continuous Spatial Populations. Environmetrics 8:167-195.

USEPA. 2006. Wadeable Streams Assessment: A Collaborative Survey of the Nation's Streams. EPA 841-B-06-002. Office of Research and Development, Office of Water, Washington, DC 20460.

USEPA. 2000. Mid-Atlantic Highlands Streams Assessment. EPA/903/R-00/015. United States Environmental Protection Agency, Region 3, Philadelphia, PA 19103.

USEPA. 1999. Rapid Bioassessment Protocols for Use in Wadeable Streams and Rivers. Office of Water. EPA/841/B-99/002.

Van Sickle, John and S.G. Paulsen. 2008. Assessing the attributable risks, relative risks, and regional extents of aquatic stressor. Journal of the North American Benthological Society. 27(4):920-931.

Van Sickle, John, J. Stoddard, S. Paulsen, A. Olsen. 2006. Using Relative Risk to Compare the Effects of Aquatic	Stressors at a Regional Scale. Environ Manage 38:1020-1030.

Virginia Department of Environmental Quality. 2018. 2018 Water Quality Assessment Guidance Manual.  http://www.deq.virginia.gov/Portals/0/DEQ/Water/WaterQualityAssessments/2018_WQA_Guidance_DRAFT.pdf. 

Virginia Department of Environmental Quality. 2017. Stressor Analysis in Virginia: Data Collection and Stressor Thresholds. http://www.deq.virginia.gov/Portals/0/DEQ/Water/WaterQualityMonitoring/ProbabilisticMonitoring/Products/Stressor_Doc.zip. 

Virginia Department of Environmental Quality. 2013. The Virginia Coastal Plain Macroinvertebrate Index. Technical Bulletin. WQA/2013-002.Richmond, Virginia.   
http://www.deq.virginia.gov/Portals/0/DEQ/Water/WaterQualityMonitoring/ProbabilisticMonitoring/vcpmi.pdf.

Virginia Department of Environmental Quality. 2011. 2012 Water Quality Assessment Guidance Manual. http://www.deq.state.va.us/waterguidance/pdf/112007.pdf.

Virginia Department of Environmental Quality. 2006a.Using Probabilistic Monitoring Data to Validate the Non-Coastal Virginia Stream Condition Index. VDEQ Technical Bulletin. WQA/2006-001. http://www.deq.virginia.gov/probmon/pdf/scival.pdf.

Virginia Department of Environmental Quality. 2006b. Fecal Bacteria and General Standard Total Maximum Daily Load Development for Straight Creek. Richmond, Virginia. VDEQ TMDL Study. http://www.deq.virginia.gov/tmdl/apptmdls/tenbigrvr/straight.pdf.

Virginia Department of Environmental Quality. 2003. The Quality of Virginia Non-Tidal Streams: First Year Report. Richmond, Virginia. VDEQ Technical Bulletin WQA/2002-001. http://www.deq.virginia.gov/probmon/pdf/report1.pdf.

Virginia Water Control Board. 1990. Comprehensive Review of Selected Toxic Substances and Environmental	Samples in Virginia. Richmond, Virginia. Information Bulletin 583.


